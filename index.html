<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Ad Generator - fal.ai</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background-color: #f9f9f9;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        textarea, input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .result {
            margin-top: 30px;
            display: none;
        }
        .result h2 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .video-container {
            width: 100%;
            background-color: #eee;
            padding: 20px;
            border-radius: 4px;
            text-align: center;
        }
        video {
            max-width: 100%;
            border-radius: 4px;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            display: none;
        }
        .loading-text {
            margin-top: 10px;
            font-style: italic;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
            display: none;
        }
        .steps {
            margin-top: 20px;
            display: none;
        }
        .step {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            background-color: #f1f9ff;
        }
        .step.completed {
            background-color: #d4edda;
        }
        .api-key-form {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Video Ad Generator</h1>
        
        <div class="api-key-form">
            <div class="form-group">
                <label for="api-key">fal.ai API Key</label>
                <input type="text" id="api-key" placeholder="Enter your fal.ai API key" required>
                <small>Your key is stored locally and never sent to our servers</small>
            </div>
        </div>
        
        <div class="form-group">
            <label for="marketing-text">Marketing Text</label>
            <textarea id="marketing-text" placeholder="Enter your marketing copy or product description" required></textarea>
        </div>
        
        <div class="form-group">
            <label for="brand">Brand Name</label>
            <input type="text" id="brand" placeholder="Enter your brand name" required>
        </div>
        
        <div class="form-group">
            <label for="style">Visual Style</label>
            <select id="style">
                <option value="modern">Modern - Clean visuals with smooth transitions</option>
                <option value="vintage">Vintage - Nostalgic feel with film grain and warm tones</option>
                <option value="energetic">Energetic - High energy with bold colors and quick cuts</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="voice">Voice Style</label>
            <select id="voice">
                <option value="professional">Professional - Clear and authoritative</option>
                <option value="friendly">Friendly - Warm and approachable</option>
                <option value="authoritative">Authoritative - Commanding and confident</option>
            </select>
        </div>
        
        <button id="generate-btn">Generate Video Ad</button>
        
        <div class="error" id="error-message"></div>
        
        <div class="loading" id="loading">
            <div class="spinner">
                <svg width="40" height="40" viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="#3498db" stroke-width="5">
                        <animate attributeName="stroke-dashoffset" dur="1.5s" repeatCount="indefinite" from="0" to="502"></animate>
                        <animate attributeName="stroke-dasharray" dur="1.5s" repeatCount="indefinite" values="150.6 100.4;1 250;150.6 100.4"></animate>
                    </circle>
                </svg>
            </div>
            <div class="loading-text">Generating your video ad... This may take a few minutes</div>
        </div>
        
        <div class="steps" id="steps">
            <div class="step" id="step1">1. Creating enhanced visual prompts from your marketing text...</div>
            <div class="step" id="step2">2. Generating video based on your brand and style...</div>
            <div class="step" id="step3">3. Creating voiceover with selected voice style...</div>
            <div class="step" id="step4">4. Combining video and audio into final advertisement...</div>
        </div>
        
        <div class="result" id="result">
            <h2>Your Generated Video Ad</h2>
            <div class="video-container">
                <video id="video-result" controls>
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            fal: {
                baseUrl: 'https://api.fal.ai/v1',
                models: {
                    textToVideo: 'fal-ai/fast-sdxl-video',
                    textToSpeech: 'fal-ai/realistic-voice',
                    videoComposition: 'fal-ai/video-composition'
                },
                stylePresets: {
                    modern: "A sleek, modern advertisement with clean visuals and smooth transitions",
                    vintage: "A nostalgic, vintage advertisement with film grain and warm tones",
                    energetic: "A high-energy, dynamic advertisement with bold colors and quick cuts"
                },
                voicePresets: {
                    professional: { voiceId: "en-US-ryan", speed: 1.0, pitch: 0 },
                    friendly: { voiceId: "en-US-amy", speed: 1.1, pitch: 1 },
                    authoritative: { voiceId: "en-US-davis", speed: 0.9, pitch: -1 }
                }
            }
        };

        // DOM Elements
        const generateBtn = document.getElementById('generate-btn');
        const apiKeyInput = document.getElementById('api-key');
        const marketingText = document.getElementById('marketing-text');
        const brandInput = document.getElementById('brand');
        const styleSelect = document.getElementById('style');
        const voiceSelect = document.getElementById('voice');
        const loadingEl = document.getElementById('loading');
        const resultEl = document.getElementById('result');
        const videoResult = document.getElementById('video-result');
        const errorMessage = document.getElementById('error-message');
        const stepsEl = document.getElementById('steps');
        const steps = {
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            step4: document.getElementById('step4')
        };

        // Check if API key is saved in local storage
        document.addEventListener('DOMContentLoaded', () => {
            const savedApiKey = localStorage.getItem('falApiKey');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
        });

        // Event Listeners
        generateBtn.addEventListener('click', generateAd);

        async function generateAd() {
            // Reset UI
            errorMessage.style.display = 'none';
            resultEl.style.display = 'none';
            
            // Get input values
            const apiKey = apiKeyInput.value.trim();
            const text = marketingText.value.trim();
            const brand = brandInput.value.trim();
            const style = styleSelect.value;
            const voice = voiceSelect.value;
            
            // Validate inputs
            if (!apiKey) {
                showError('Please enter your fal.ai API key');
                return;
            }
            
            if (!text) {
                showError('Please enter your marketing text');
                return;
            }
            
            if (!brand) {
                showError('Please enter your brand name');
                return;
            }
            
            // Save API key to local storage
            localStorage.setItem('falApiKey', apiKey);
            
            // Show loading state
            generateBtn.disabled = true;
            loadingEl.style.display = 'flex';
            stepsEl.style.display = 'block';
            
            try {
                // Step 1: Create enhanced prompt
                updateStep('step1', 'in-progress');
                const videoPrompt = createEnhancedPrompt(text, brand, style);
                updateStep('step1', 'completed');
                
                // Step 2: Generate video
                updateStep('step2', 'in-progress');
                const videoResult = await generateVideo(apiKey, videoPrompt, style);
                updateStep('step2', 'completed');
                
                // Step 3: Generate voiceover
                updateStep('step3', 'in-progress');
                const audioResult = await generateVoiceover(apiKey, text, voice);
                updateStep('step3', 'completed');
                
                // Step 4: Combine video and audio
                updateStep('step4', 'in-progress');
                const finalVideo = await combineVideoAudio(apiKey, videoResult.videoUrl, audioResult.audioUrl);
                updateStep('step4', 'completed');
                
                // Show result
                displayResult(finalVideo);
            } catch (error) {
                showError(error.message || 'An error occurred while generating your video');
                console.error('Error:', error);
            } finally {
                generateBtn.disabled = false;
                loadingEl.style.display = 'none';
            }
        }

        function createEnhancedPrompt(text, brand, style) {
            const stylePrompt = config.fal.stylePresets[style] || config.fal.stylePresets.modern;
            return `Create an advertisement for ${brand} brand: "${text}". ${stylePrompt}. Brand: ${brand}.`;
        }

        async function generateVideo(apiKey, prompt, style) {
            try {
                const response = await fetch(`${config.fal.baseUrl}/models/${config.fal.models.textToVideo}/run`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Key ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt,
                        negative_prompt: "poor quality, blurry, amateur, text overlay, watermark",
                        num_frames: 24,  // 1 second at 24fps
                        width: 1024,
                        height: 576,
                        num_inference_steps: 30
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Video generation failed with status: ${response.status}`);
                }
                
                const data = await response.json();
                return { videoUrl: data.video_url || data.url || "video_url_placeholder" };
            } catch (error) {
                console.error('Error generating video:', error);
                throw new Error('Failed to generate video. Please check your API key and try again.');
            }
        }

        async function generateVoiceover(apiKey, text, voiceType) {
            try {
                const voiceSettings = config.fal.voicePresets[voiceType] || config.fal.voicePresets.professional;
                
                const response = await fetch(`${config.fal.baseUrl}/models/${config.fal.models.textToSpeech}/run`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Key ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text,
                        ...voiceSettings
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Voiceover generation failed with status: ${response.status}`);
                }
                
                const data = await response.json();
                return { audioUrl: data.audio_url || data.url || "audio_url_placeholder" };
            } catch (error) {
                console.error('Error generating voiceover:', error);
                throw new Error('Failed to generate voiceover. Please check your API key and try again.');
            }
        }

        async function combineVideoAudio(apiKey, videoUrl, audioUrl) {
            try {
                const response = await fetch(`${config.fal.baseUrl}/models/${config.fal.models.videoComposition}/run`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Key ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        video_url: videoUrl,
                        audio_url: audioUrl,
                        output_format: "mp4"
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Video composition failed with status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.output_url || data.url || "final_video_url_placeholder";
            } catch (error) {
                console.error('Error combining video and audio:', error);
                throw new Error('Failed to combine video and audio. Please check your API key and try again.');
            }
        }

        function updateStep(stepId, status) {
            const step = steps[stepId];
            if (status === 'in-progress') {
                step.classList.remove('completed');
            } else if (status === 'completed') {
                step.classList.add('completed');
            }
        }

        function displayResult(videoUrl) {
            videoResult.src = videoUrl;
            resultEl.style.display = 'block';
            // Scroll to result
            resultEl.scrollIntoView({ behavior: 'smooth' });
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
    </script>
</body>
</html>
